import{S as me,i as ce,s as _e,a as B,y as T,W as pe,h as d,c as D,z as U,b as E,A as Y,g as W,d as j,B as H,o as de,w as M,N as R,k,l as y,m as G,n as O,G as _,Q as q,t as ge,q as $,r as v,u as le,H as he}from"../chunks/index.fdf84907.js";import{c as $e,a as ne,I as ae}from"../chunks/Input.78a87232.js";import{R as re,e as ve,V as be,W as Ne,X as Ee}from"../chunks/dataFetching.f2a9713f.js";import{B as we}from"../chunks/Button.80ee52cd.js";import{B as ke}from"../chunks/BrowserCheck.ea95e5bb.js";function oe(n){let e,t,i,s,u,m,o,c,b;return{c(){e=k("div"),t=k("h1"),i=$("User Registration"),s=$(`
                E-Mail domains are restricted.`),u=k("br"),m=$(`
                Allowed domain: `),o=k("code"),c=$("@"),b=$(n[0]),this.h()},l(g){e=y(g,"DIV",{class:!0});var f=G(e);t=y(f,"H1",{});var w=G(t);i=v(w,"User Registration"),w.forEach(d),s=v(f,`
                E-Mail domains are restricted.`),u=y(f,"BR",{}),m=v(f,`
                Allowed domain: `),o=y(f,"CODE",{});var N=G(o);c=v(N,"@"),b=v(N,n[0]),N.forEach(d),f.forEach(d),this.h()},h(){O(e,"class","domainTxt svelte-1ks9oi1")},m(g,f){E(g,e,f),_(e,t),_(t,i),_(e,s),_(e,u),_(e,m),_(e,o),_(o,c),_(o,b)},p(g,f){f&1&&le(b,g[0])},d(g){g&&d(e)}}}function ye(n){let e;return{c(){e=$("E-MAIL")},l(t){e=v(t,"E-MAIL")},m(t,i){E(t,e,i)},d(t){t&&d(e)}}}function Me(n){let e;return{c(){e=$("GIVEN NAME")},l(t){e=v(t,"GIVEN NAME")},m(t,i){E(t,e,i)},d(t){t&&d(e)}}}function Re(n){let e;return{c(){e=$("FAMILY NAME")},l(t){e=v(t,"FAMILY NAME")},m(t,i){E(t,e,i)},d(t){t&&d(e)}}}function qe(n){let e;return{c(){e=$("REGISTER")},l(t){e=v(t,"REGISTER")},m(t,i){E(t,e,i)},d(t){t&&d(e)}}}function Ie(n){let e,t;return{c(){e=k("div"),t=$(n[2]),this.h()},l(i){e=y(i,"DIV",{class:!0});var s=G(e);t=v(s,n[2]),s.forEach(d),this.h()},h(){O(e,"class","err svelte-1ks9oi1")},m(i,s){E(i,e,s),_(e,t)},p(i,s){s&4&&le(t,i[2])},d(i){i&&d(e)}}}function Ae(n){let e,t,i,s;return{c(){e=k("div"),t=$("Registration successful."),i=k("br"),s=$(`
                Please check your E-Mail inbox.`),this.h()},l(u){e=y(u,"DIV",{class:!0});var m=G(e);t=v(m,"Registration successful."),i=y(m,"BR",{}),s=v(m,`
                Please check your E-Mail inbox.`),m.forEach(d),this.h()},h(){O(e,"class","success svelte-1ks9oi1")},m(u,m){E(u,e,m),_(e,t),_(e,i),_(e,s)},p:he,d(u){u&&d(e)}}}function Le(n){let e,t,i,s,u,m,o,c,b,g,f,w,N,V,h,C,P,I,r=n[0]&&oe(n);function Q(a){n[8](a)}function J(a){n[9](a)}let F={type:"email",autocomplete:"email",placeholder:"E-Mail",$$slots:{default:[ye]},$$scope:{ctx:n}};n[4].email!==void 0&&(F.value=n[4].email),n[5].email!==void 0&&(F.error=n[5].email),i=new ae({props:F}),M.push(()=>R(i,"value",Q)),M.push(()=>R(i,"error",J)),i.$on("keypress",n[6]);function Z(a){n[10](a)}function x(a){n[11](a)}let A={autocomplete:"given-name",placeholder:"Given NAme",$$slots:{default:[Me]},$$scope:{ctx:n}};n[4].givenName!==void 0&&(A.value=n[4].givenName),n[5].givenName!==void 0&&(A.error=n[5].givenName),o=new ae({props:A}),M.push(()=>R(o,"value",Z)),M.push(()=>R(o,"error",x)),o.$on("keypress",n[6]);function S(a){n[12](a)}function ue(a){n[13](a)}let ee={autocomplete:"family-name",placeholder:"Family Name",$$slots:{default:[Re]},$$scope:{ctx:n}};n[4].familyName!==void 0&&(ee.value=n[4].familyName),n[5].familyName!==void 0&&(ee.error=n[5].familyName),f=new ae({props:ee}),M.push(()=>R(f,"value",S)),M.push(()=>R(f,"error",ue)),f.$on("keypress",n[6]);function fe(a){n[14](a)}let ie={$$slots:{default:[qe]},$$scope:{ctx:n}};n[1]!==void 0&&(ie.isLoading=n[1]),h=new we({props:ie}),M.push(()=>R(h,"isLoading",fe)),h.$on("click",n[7]);function se(a,l){if(a[3])return Ae;if(a[2])return Ie}let L=se(n),p=L&&L(n);return{c(){e=k("div"),r&&r.c(),t=B(),T(i.$$.fragment),m=B(),T(o.$$.fragment),g=B(),T(f.$$.fragment),V=B(),T(h.$$.fragment),P=B(),p&&p.c(),this.h()},l(a){e=y(a,"DIV",{class:!0});var l=G(e);r&&r.l(l),t=D(l),U(i.$$.fragment,l),m=D(l),U(o.$$.fragment,l),g=D(l),U(f.$$.fragment,l),V=D(l),U(h.$$.fragment,l),P=D(l),p&&p.l(l),l.forEach(d),this.h()},h(){O(e,"class","container svelte-1ks9oi1")},m(a,l){E(a,e,l),r&&r.m(e,null),_(e,t),Y(i,e,null),_(e,m),Y(o,e,null),_(e,g),Y(f,e,null),_(e,V),Y(h,e,null),_(e,P),p&&p.m(e,null),I=!0},p(a,l){a[0]?r?r.p(a,l):(r=oe(a),r.c(),r.m(e,t)):r&&(r.d(1),r=null);const X={};l&65536&&(X.$$scope={dirty:l,ctx:a}),!s&&l&16&&(s=!0,X.value=a[4].email,q(()=>s=!1)),!u&&l&32&&(u=!0,X.error=a[5].email,q(()=>u=!1)),i.$set(X);const z={};l&65536&&(z.$$scope={dirty:l,ctx:a}),!c&&l&16&&(c=!0,z.value=a[4].givenName,q(()=>c=!1)),!b&&l&32&&(b=!0,z.error=a[5].givenName,q(()=>b=!1)),o.$set(z);const K={};l&65536&&(K.$$scope={dirty:l,ctx:a}),!w&&l&16&&(w=!0,K.value=a[4].familyName,q(()=>w=!1)),!N&&l&32&&(N=!0,K.error=a[5].familyName,q(()=>N=!1)),f.$set(K);const te={};l&65536&&(te.$$scope={dirty:l,ctx:a}),!C&&l&2&&(C=!0,te.isLoading=a[1],q(()=>C=!1)),h.$set(te),L===(L=se(a))&&p?p.p(a,l):(p&&p.d(1),p=L&&L(a),p&&(p.c(),p.m(e,null)))},i(a){I||(W(i.$$.fragment,a),W(o.$$.fragment,a),W(f.$$.fragment,a),W(h.$$.fragment,a),I=!0)},o(a){j(i.$$.fragment,a),j(o.$$.fragment,a),j(f.$$.fragment,a),j(h.$$.fragment,a),I=!1},d(a){a&&d(e),r&&r.d(),H(i),H(o),H(f),H(h),p&&p.d()}}}function Be(n){let e,t,i;return t=new ke({props:{$$slots:{default:[Le]},$$scope:{ctx:n}}}),{c(){e=B(),T(t.$$.fragment),this.h()},l(s){pe("svelte-x3krtu",document.head).forEach(d),e=D(s),U(t.$$.fragment,s),this.h()},h(){document.title="Register"},m(s,u){E(s,e,u),Y(t,s,u),i=!0},p(s,[u]){const m={};u&65599&&(m.$$scope={dirty:u,ctx:s}),t.$set(m)},i(s){i||(W(t.$$.fragment,s),i=!0)},o(s){j(t.$$.fragment,s),i=!1},d(s){s&&d(e),H(t,s)}}}function De(n,e,t){let i,s=!1,u="",m=!1,o={},c={};const b=$e().shape({email:ne().required("E-Mail is required").email("Bad E-Mail format"),givenName:ne().required("Given Name is required").matches(re,"Your given name with 2 - 32  non-special characters"),familyName:ne().required("Family Name is required").matches(re,"Your family name with 2 - 32  non-special characters")});de(()=>{t(0,i=window.document.getElementsByName("rauthy-data")[0].id)});function g(r){r.detail.code==="Enter"&&f()}async function f(){t(3,m=!1),t(2,u="");try{await b.validate(o,{abortEarly:!1}),t(5,c={})}catch(S){t(5,c=ve(S));return}if(!o.email.endsWith(i)){t(2,u="E-Mail domain not allowed");return}t(1,s=!0),await ge();let Q=await(await be()).json(),J=new Date().getUTCMilliseconds();const F=Ne(Q);let Z=new Date().getUTCMilliseconds()-J;console.log("pow computation took "+Z+" ms");const x={email:o.email,given_name:o.givenName,family_name:o.familyName,pow:F},A=await Ee(x);if(A.ok)t(2,u=""),t(3,m=!0);else{const S=await A.json();t(2,u=S.message)}t(1,s=!1)}function w(r){n.$$.not_equal(o.email,r)&&(o.email=r,t(4,o))}function N(r){n.$$.not_equal(c.email,r)&&(c.email=r,t(5,c))}function V(r){n.$$.not_equal(o.givenName,r)&&(o.givenName=r,t(4,o))}function h(r){n.$$.not_equal(c.givenName,r)&&(c.givenName=r,t(5,c))}function C(r){n.$$.not_equal(o.familyName,r)&&(o.familyName=r,t(4,o))}function P(r){n.$$.not_equal(c.familyName,r)&&(c.familyName=r,t(5,c))}function I(r){s=r,t(1,s)}return[i,s,u,m,o,c,g,f,w,N,V,h,C,P,I]}class Se extends me{constructor(e){super(),ce(this,e,De,Be,_e,{})}}export{Se as component};
