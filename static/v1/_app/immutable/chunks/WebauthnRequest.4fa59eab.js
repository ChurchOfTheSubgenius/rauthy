import{S as X,i as Y,s as Z,k as h,q as L,a as K,l as p,m,r as P,h as c,c as O,n as d,b as M,G as i,v as $,d as F,f as ee,g as H,I as te,o as z,y as se,z as ae,A as re,H as R,B as le,u as oe}from"./index.fdf84907.js";import{t as ne}from"./PasswordInput.969a95d0.js";import{L as ie}from"./Loading.a4841b1e.js";import{h as ce,b as Q,c as B,i as ue}from"./dataFetching.f2a9713f.js";async function de(n,e){let s=await ce(n,e);if(s.status===200){let t=await s.json(),a=t.rcr;a.publicKey.challenge=Q(a.publicKey.challenge);for(let f of a.publicKey.allowCredentials)f.id=Q(f.id);let l;try{l=await navigator.credentials.get(a)}catch{return{err:!0,msg:"Invalid Key used"}}let w={code:t.code,data:{id:l.id,rawId:B(l.rawId),response:{authenticatorData:B(l.response.authenticatorData),clientDataJSON:B(l.response.clientDataJSON),signature:B(l.response.signature)},type:l.type}};if(s=await ue(n,w),s.status===202)return{err:!1,msg:"Authentication successful",body:await s.json()};console.error(s)}else return{err:!0,msg:"Error starting the Authentication"}}function fe(n){let e,s;return e=new ie({props:{background:!1}}),{c(){se(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,a){re(e,t,a),s=!0},p:R,i(t){s||(H(e.$$.fragment,t),s=!0)},o(t){F(e.$$.fragment,t),s=!1},d(t){le(e,t)}}}function ve(n){let e,s;return{c(){e=h("div"),s=L(n[2]),this.h()},l(t){e=p(t,"DIV",{class:!0});var a=m(e);s=P(a,n[2]),a.forEach(c),this.h()},h(){d(e,"class","err svelte-la7b1d")},m(t,a){M(t,e,a),i(e,s)},p(t,a){a&4&&oe(s,t[2])},i:R,o:R,d(t){t&&c(e)}}}function _e(n){let e,s;return{c(){e=h("div"),s=L("Acknowledged"),this.h()},l(t){e=p(t,"DIV",{class:!0});var a=m(e);s=P(a,"Acknowledged"),a.forEach(c),this.h()},h(){d(e,"class","good svelte-la7b1d")},m(t,a){M(t,e,a),i(e,s)},p:R,i:R,o:R,d(t){t&&c(e)}}}function he(n){let e,s,t,a,l,w,f,g,y,I,k,r,u,x,T,D,v,_,S;const W=[_e,ve,fe],E=[];function j(o,b){return o[3]?0:o[1]?1:2}return v=j(n),_=E[v]=W[v](n),{c(){e=h("div"),s=h("div"),t=h("div"),a=h("div"),l=h("div"),w=L("Please login with your MFA device"),f=K(),g=h("div"),y=h("div"),I=L("Request expires:"),k=K(),r=h("div"),u=h("progress"),T=K(),D=h("div"),_.c(),this.h()},l(o){e=p(o,"DIV",{class:!0});var b=m(e);s=p(b,"DIV",{class:!0});var A=m(s);t=p(A,"DIV",{class:!0});var V=m(t);a=p(V,"DIV",{class:!0});var C=m(a);l=p(C,"DIV",{class:!0});var G=m(l);w=P(G,"Please login with your MFA device"),G.forEach(c),C.forEach(c),f=O(V),g=p(V,"DIV",{class:!0});var q=m(g);y=p(q,"DIV",{class:!0});var J=m(y);I=P(J,"Request expires:"),J.forEach(c),k=O(q),r=p(q,"DIV",{});var N=m(r);u=p(N,"PROGRESS",{max:!0,class:!0}),m(u).forEach(c),N.forEach(c),q.forEach(c),T=O(V),D=p(V,"DIV",{class:!0});var U=m(D);_.l(U),U.forEach(c),V.forEach(c),A.forEach(c),b.forEach(c),this.h()},h(){d(l,"class","contentHeader svelte-la7b1d"),d(a,"class","contentRow svelte-la7b1d"),d(y,"class","contentHeader svelte-la7b1d"),u.value=n[4],d(u,"max",x=n[0].exp),d(u,"class","svelte-la7b1d"),d(g,"class","contentRow svelte-la7b1d"),d(D,"class","contentRow svelte-la7b1d"),d(t,"class","content svelte-la7b1d"),d(s,"class","wrapperInner svelte-la7b1d"),d(e,"class","wrapperOuter svelte-la7b1d")},m(o,b){M(o,e,b),i(e,s),i(s,t),i(t,a),i(a,l),i(l,w),i(t,f),i(t,g),i(g,y),i(y,I),i(g,k),i(g,r),i(r,u),i(t,T),i(t,D),E[v].m(D,null),S=!0},p(o,[b]){(!S||b&16)&&(u.value=o[4]),(!S||b&1&&x!==(x=o[0].exp))&&d(u,"max",x);let A=v;v=j(o),v===A?E[v].p(o,b):($(),F(E[A],1,1,()=>{E[A]=null}),ee(),_=E[v],_?_.p(o,b):(_=E[v]=W[v](o),_.c()),H(_,1),_.m(D,null))},i(o){S||(H(_),S=!0)},o(o){F(_),S=!1},d(o){o&&c(e),E[v].d()}}}function pe(n,e,s){let t,{data:a}=e,{purpose:l="Login"}=e,{onError:w=()=>{}}=e,{onSuccess:f=r=>{}}=e,g=!1,y="",I=!1,k=ne(a.exp,{duration:a.exp*1e3});return te(n,k,r=>s(4,t=r)),z(()=>{let r=setTimeout(()=>{s(0,a=void 0)},a.exp*1e3);return k.set(0),()=>clearTimeout(r)}),z(async()=>{let r;l==="Login"?r={purpose:{Login:a.code}}:r={purpose:"PasswordReset"};let u=await de(a.user_id,r);s(1,g=u.err),s(3,I=!u.err),s(2,y=u.msg),I?f(u.body):setTimeout(()=>{w()},3e3)}),n.$$set=r=>{"data"in r&&s(0,a=r.data),"purpose"in r&&s(6,l=r.purpose),"onError"in r&&s(7,w=r.onError),"onSuccess"in r&&s(8,f=r.onSuccess)},[a,g,y,I,t,k,l,w,f]}class ye extends X{constructor(e){super(),Y(this,e,pe,he,Z,{data:0,purpose:6,onError:7,onSuccess:8})}}export{ye as W};
